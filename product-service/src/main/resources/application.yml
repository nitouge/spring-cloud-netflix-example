server:
  port: 8082

spring:
  application:
    name: product-service
  datasource:
    url: jdbc:mysql://localhost:3306/netflix_example?useUnicode=true&characterEncoding=utf8&useSSL=false&serverTimezone=Asia/Shanghai
    username: root
    password: root@123456
    driver-class-name: com.mysql.cj.jdbc.Driver
  jpa:
    hibernate:
      ddl-auto: update
    show-sql: true
    properties:
      hibernate:
        dialect: org.hibernate.dialect.MySQL8Dialect
        format_sql: true

eureka:
  client:
    service-url:
      defaultZone: http://admin:123456@localhost:8761/eureka/
    registry-fetch-interval-seconds: 50
  instance:
    instance-id: ${spring.application.name}:${server.port}
    prefer-ip-address: true
    lease-renewal-interval-in-seconds: 50
    lease-expiration-duration-in-seconds: 100

# Hystrix配置 - 商品服务保护
hystrix:
  command:
    default:
      execution:
        isolation:
          strategy: THREAD
          thread:
            timeoutInMilliseconds: 3000
        timeout:
          enabled: true
      circuitBreaker:
        enabled: true
        requestVolumeThreshold: 5
        errorThresholdPercentage: 50
        sleepWindowInMilliseconds: 10000
      metrics:
        rollingStats:
          timeInMilliseconds: 10000
        rollingPercentile:
          enabled: true
        healthSnapshot:
          intervalInMilliseconds: 500

    # 特定方法配置
    ProductService#findById(Long):
      execution:
        isolation:
          thread:
            timeoutInMilliseconds: 2000
      circuitBreaker:
        errorThresholdPercentage: 40
        sleepWindowInMilliseconds: 5000

    # 库存扣减方法配置（更严格的超时），库存操作需要更快响应
    ProductService#deductStock(Long,Integer):
      execution:
        isolation:
          thread:
            timeoutInMilliseconds: 1000

  # 线程池配置
  threadpool:
    default:
      coreSize: 10           # 核心线程数
      maximumSize: 20        # 最大线程数
      maxQueueSize: 1000     # 队列大小
      queueSizeRejectionThreshold: 100 # 队列拒绝阈值


# 移除Ribbon配置
ribbon:
  eureka:
    enabled: true
  ConnectTimeout: 2000
  ReadTimeout: 3000
  MaxAutoRetries: 1
  MaxAutoRetriesNextServer: 1
  OkToRetryOnAllOperations: false
  ServerListRefreshInterval: 20000
  NFLoadBalancerRuleClassName: com.netflix.loadbalancer.RoundRobinRule # 负载均衡策略

# 日志配置
logging:
  level:
    com.lsj.cloud: DEBUG
    org.hibernate.SQL: DEBUG
    org.springframework.cloud.netflix.eureka: DEBUG
    feign: DEBUG
    com.netflix.eureka: DEBUG
    com.netflix.discovery: DEBUG
    com.netflix.hystrix: DEBUG
    com.netflx.ribbon: DEBUG
    com.netflix.loadbalancer: DEBUG
  pattern:
    console: '%red(%d{yyyy-MM-dd HH:mm:ss.SSS}) %yellow([%-5p]) %highlight([%t]) %boldMagenta([%C]) %green([%L]) %m%n'
server:
  port: 8081

spring:
  application:
    name: user-service
  datasource:
    url: jdbc:mysql://localhost:3306/netflix_example?useUnicode=true&characterEncoding=utf8&useSSL=false&serverTimezone=Asia/Shanghai
    username: root
    password: root@123456
    driver-class-name: com.mysql.cj.jdbc.Driver
  jpa:
    hibernate:
      ddl-auto: update
    show-sql: true
    properties:
      hibernate:
        dialect: org.hibernate.dialect.MySQL8Dialect
        format_sql: true

eureka:
  client:
    service-url:
      defaultZone: http://admin:123456@localhost:8761/eureka/
    # 获取服务列表间隔时间
    registry-fetch-interval-seconds: 50
  instance:
    instance-id: ${spring.application.name}:${server.port}
    prefer-ip-address: true
    # 心跳间隔
    lease-renewal-interval-in-seconds: 50
    # 服务失效时间
    lease-expiration-duration-in-seconds: 100

# 用户服务主要作为服务提供者，不需要Feign和Hystrix客户端配置
# 只保留服务端Hystrix配置用于自我保护
# Hystrix配置（用于保护用户服务自身）
hystrix:
  command:
    default:
      execution:
        isolation:
          strategy: THREAD
          thread:
            timeoutInMilliseconds: 3000  # 超时时间3秒
        timeout:
          enabled: true
      circuitBreaker:
        enabled: true
        requestVolumeThreshold: 5        # 触发熔断的最小请求数量，默认20
        errorThresholdPercentage: 50     # 错误百分比，默认50%
        sleepWindowInMilliseconds: 10000 # 熔断时间，默认5秒
      metrics:
        rollingStats:
          timeInMilliseconds: 10000      # 统计窗口时间

    # 线程池配置
    UserService#findById(Long):
      execution:
        isolation:
          thread:
            timeoutInMilliseconds: 2000  # 特定方法超时时间

# 移除Ribbon配置，因为用户服务不调用其他服务
# Ribbon配置（用户服务作为客户端调用其他服务时使用）
#ribbon:
#  eureka:
#    enabled: true
#  # 连接超时时间
#  ConnectTimeout: 2000
#  # 读取超时时间
#  ReadTimeout: 3000
#  # 对当前实例的重试次数
#  MaxAutoRetries: 1
#  # 切换实例的重试次数
#  MaxAutoRetriesNextServer: 1
#  # 是否对所有操作都重试
#  OkToRetryOnAllOperations: false
#  # 服务器列表刷新间隔
#  ServerListRefreshInterval: 2000

# 日志配置
logging:
  level:
    com.lsj.cloud: DEBUG
    org.hibernate.SQL: DEBUG
    org.springframework.cloud.netflix.eureka: DEBUG
    com.netflix.eureka: DEBUG
    com.netflix.discovery: DEBUG
    com.netflix.hystrix: DEBUG
    com.netflx.ribbon: DEBUG
    com.netflix.loadbalancer: DEBUG
  pattern:
    console: '%red(%d{yyyy-MM-dd HH:mm:ss.SSS}) %yellow([%-5p]) %highlight([%t]) %boldMagenta([%C]) %green([%L]) %m%n'